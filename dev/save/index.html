<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Saving Tools · DrWatson.jl</title><meta name="title" content="Saving Tools · DrWatson.jl"/><meta property="og:title" content="Saving Tools · DrWatson.jl"/><meta property="twitter:title" content="Saving Tools · DrWatson.jl"/><meta name="description" content="Documentation for DrWatson.jl."/><meta property="og:description" content="Documentation for DrWatson.jl."/><meta property="twitter:description" content="Documentation for DrWatson.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="DrWatson.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">DrWatson.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../workflow/">DrWatson Workflow Tutorial</a></li><li><a class="tocitem" href="../project/">Project Setup</a></li><li><a class="tocitem" href="../name/">Naming Simulations</a></li><li class="is-active"><a class="tocitem" href>Saving Tools</a><ul class="internal"><li><a class="tocitem" href="#Safely-saving-data"><span>Safely saving data</span></a></li><li><a class="tocitem" href="#Tagging-a-run-using-Git"><span>Tagging a run using Git</span></a></li><li><a class="tocitem" href="#Produce-or-Load"><span>Produce or Load</span></a></li><li><a class="tocitem" href="#Converting-a-struct-to-a-dictionary"><span>Converting a struct to a dictionary</span></a></li></ul></li><li><a class="tocitem" href="../run&amp;list/">Running &amp; Listing Simulations</a></li><li><a class="tocitem" href="../real_world/">Real World Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Saving Tools</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Saving Tools</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/DrWatson.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/main/docs/src/save.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Saving-Tools"><a class="docs-heading-anchor" href="#Saving-Tools">Saving Tools</a><a id="Saving-Tools-1"></a><a class="docs-heading-anchor-permalink" href="#Saving-Tools" title="Permalink"></a></h1><p>This page discusses numerous tools that can significantly improve process of saving &amp; loading files, always in a scientific context.</p><p>These tools are also used in the examples demonstrated in the <a href="../real_world/#Real-World-Examples">Real World Examples</a> page. After reading the proper documentation here it might be worth it to have a look there as well!</p><p>In DrWatson we save and load files with the functions <code>wsave(filename, data)</code> and <code>wload(filename)</code>. These functions are further used in the tools below, like e.g. <a href="#DrWatson.tagsave"><code>tagsave</code></a> and can be overloaded for your own specific datatype.</p><p>In addition, <code>wsave</code> <strong>ensures</strong> that <code>mkpath</code> is always called on the path you are trying to save your file at. We all know how unpleasant it is to run a 2-hour simulation and save no data because <code>FileIO.save</code> complains that the path you are trying to save at does not exist...</p><p>To overload the saving part, add a new method to <code>DrWatson._wsave(filename, ::YourType, args...; kwargs...)</code> (notice the <code>_</code>!). By overloading <code>_wsave</code> you get all the extra functionality of <a href="#DrWatson.tagsave"><code>tagsave</code></a>, <a href="#DrWatson.safesave"><code>safesave</code></a>, etc., for free for your own types (<code>tagsave</code> requires that you save your data as a dictionary, or extend <a href="#DrWatson.tag!"><code>tag!</code></a> for your own type).</p><div class="admonition is-warning" id="Saving-and-loading-fallback-98083a6bdfd2deef"><header class="admonition-header">Saving and loading fallback<a class="admonition-anchor" href="#Saving-and-loading-fallback-98083a6bdfd2deef" title="Permalink"></a></header><div class="admonition-body"><p>By default we fallback to <code>FileIO.save</code> and <code>FileIO.load</code> for and types. This means that you have to install yourself whatever saving backend you want to use. <code>FileIO</code> by itself does <em>not</em> install a package that saves data, it only provides the interface!</p><p>The <em>suffix</em> of the file name determines which package will be used for actually saving the file. It is <strong>your responsibility</strong> to know how the saving package works and what input it expects!</p></div></div><h2 id="Safely-saving-data"><a class="docs-heading-anchor" href="#Safely-saving-data">Safely saving data</a><a id="Safely-saving-data-1"></a><a class="docs-heading-anchor-permalink" href="#Safely-saving-data" title="Permalink"></a></h2><p>Almost all packages that save data by default overwrite existing files (if given a save name of an existing file). This is the default behavior because often it is desired.</p><p>Sometimes it is not though! And the consequences of overwritten data can range from irrelevant to catastrophic. To avoid such an event we provide an alternative way to save data that will never overwrite existing files:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.safesave" href="#DrWatson.safesave"><code>DrWatson.safesave</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">safesave(filename, data...; kwargs...)</code></pre><p>Safely save <code>data</code> in <code>filename</code> by ensuring that no existing files are overwritten. Do this by renaming already existing data with a backup-number ending like <code>#1, #2, ...</code>. For example if <code>filename = test.jld2</code>, the first time you <code>safesave</code> it, the file is saved normally. The second time the existing save is renamed to <code>test_#1.jld2</code> and a new file <code>test.jld2</code> is then saved.</p><p>If a backup file already exists then its backup-number is incremented (e.g. going from <code>#2</code> to <code>#3</code>). For example safesaving <code>test.jld2</code> a third time will rename the old <code>test_#1.jld2</code> to <code>test_#2.jld2</code>, rename the old <code>test.jld2</code> to <code>test_#1.jld2</code> and then save a new <code>test.jld2</code> with the latest <code>data</code>.</p><p>Any additional keyword arguments are passed through to wsave (to e.g. enable compression).</p><p>See also <a href="#DrWatson.tagsave"><code>tagsave</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_files.jl#L254-L274">source</a></section></article><h2 id="Tagging-a-run-using-Git"><a class="docs-heading-anchor" href="#Tagging-a-run-using-Git">Tagging a run using Git</a><a id="Tagging-a-run-using-Git-1"></a><a class="docs-heading-anchor-permalink" href="#Tagging-a-run-using-Git" title="Permalink"></a></h2><p>For reproducibility reasons (and also to not go insane when asking &quot;HOW DID I GET THOSE RESUUUULTS&quot;) it is useful to &quot;tag&quot; any simulation/result/process using the Git status of the repository.</p><p>To this end we have some functions that can be used to ensure reproducibility:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.tagsave" href="#DrWatson.tagsave"><code>DrWatson.tagsave</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tagsave(file::String, d::AbstractDict; kwargs...)</code></pre><p>First <a href="#DrWatson.tag!"><code>tag!</code></a> dictionary <code>d</code> and then save <code>d</code> in <code>file</code>.</p><p>&quot;Tagging&quot; means that when saving the dictionary, an extra field <code>:gitcommit</code> is added to establish reproducibility of results using Git. If the Git repository is dirty and <code>storepatch=true</code>, one more field <code>:gitpatch</code> is added that stores the difference string. If a dictionary already contains a key <code>:gitcommit</code>, it is not overwritten, unless <code>force=true</code>. For more details, see <a href="#DrWatson.tag!"><code>tag!</code></a>.</p><p>Keywords <code>gitpath, storepatch, force,</code> are propagated to <a href="#DrWatson.tag!"><code>tag!</code></a>. Any additional keyword arguments are propagated to <code>wsave</code>, to e.g. enable compression.</p><p>The keyword <code>safe = DrWatson.readenv(&quot;DRWATSON_SAFESAVE&quot;, false)</code> decides whether to save the file using <a href="#DrWatson.safesave"><code>safesave</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_files.jl#L192-L209">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.@tagsave" href="#DrWatson.@tagsave"><code>DrWatson.@tagsave</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@tagsave(file::String, d::AbstractDict; kwargs...)</code></pre><p>Same as <a href="#DrWatson.tagsave"><code>tagsave</code></a> but one more field <code>:script</code> is added that records the local path of the script and line number that called <code>@tagsave</code>, see <a href="#DrWatson.@tag!"><code>@tag!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_files.jl#L228-L232">source</a></section></article><p>The functions also incorporate <a href="#DrWatson.safesave"><code>safesave</code></a> if need be.</p><h3 id="Low-level-functions"><a class="docs-heading-anchor" href="#Low-level-functions">Low level functions</a><a id="Low-level-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Low-level-functions" title="Permalink"></a></h3><p><a href="#DrWatson.@tagsave"><code>@tagsave</code></a> internally uses the following low level functions:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.tag!" href="#DrWatson.tag!"><code>DrWatson.tag!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tag!(d::AbstractDict; kwargs...) -&gt; d</code></pre><p>Tag <code>d</code> by adding an extra field <code>gitcommit</code> which will have as value the <a href="#DrWatson.gitdescribe"><code>gitdescribe</code></a> of the repository at <code>gitpath</code> (by default the project&#39;s gitpath). Do nothing if a key <code>gitcommit</code> already exists (unless <code>force=true</code> then replace with the new value) or if the Git repository is not found. If the git repository is dirty, i.e. there are un-commited changes, and <code>storepatch</code> is true, then the output of <code>git diff HEAD</code> is stored in the field <code>gitpatch</code>.  Note that patches for binary files are not stored. You can use <a href="#DrWatson.isdirty"><code>isdirty</code></a> to check if a repo is dirty. If the <code>commit message</code> is set to <code>true</code>, then the dictionary <code>d</code> will include an additional field <code>&quot;gitmessage&quot;</code> and will contain the git message associated  with the commit.</p><p>Notice that the key-type of the dictionary must be <code>String</code> or <code>Symbol</code>. If <code>String</code> is a subtype of the <em>value</em> type of the dictionary, this operation is in-place. Otherwise a new dictionary is created and returned.</p><p>To restore a repository to the state of a particular git commit do:</p><ol><li>checkout the relevant commit with <code>git checkout xyz</code> where <code>xyz</code> is the value stored</li><li>(optional) apply the patch <code>git apply patch</code>, where the string stored in the <code>gitpatch</code> field needs to be written to the file <code>patch</code>.</li></ol><p><strong>Keywords</strong></p><ul><li><code>gitpath = projectdir()</code></li><li><code>force = false</code></li><li><code>storepatch = DrWatson.readenv(&quot;DRWATSON_STOREPATCH&quot;, false)</code>: Whether to collect and store the output of <a href="#DrWatson.gitpatch"><code>gitpatch</code></a> as well. By default it is <code>false</code>.</li><li><code>kw...</code>: extra keywords are propagated to <a href="#DrWatson.gitdescribe"><code>gitdescribe</code></a>.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia hljs">julia&gt; d = Dict(:x =&gt; 3, :y =&gt; 4)
Dict{Symbol,Int64} with 2 entries:
  :y =&gt; 4
  :x =&gt; 3

julia&gt; tag!(d; commit_message=true)
Dict{Symbol,Any} with 3 entries:
  :y =&gt; 4
  :gitmessage =&gt; &quot;File set up by DrWatson&quot;
  :gitcommit =&gt; &quot;96df587e45b29e7a46348a3d780db1f85f41de04&quot;
  :x =&gt; 3</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L172-L215">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.@tag!" href="#DrWatson.@tag!"><code>DrWatson.@tag!</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@tag!(d, gitpath = projectdir(), storepatch = true, force = false) -&gt; d</code></pre><p>Do the same as <a href="#DrWatson.tag!"><code>tag!</code></a> but also add another field <code>script</code> that has the path of the script that called <code>@tag!</code>, relative with respect to <code>gitpath</code>. The saved string ends with <code>#line_number</code>, which indicates the line number within the script that <code>@tag!</code> was called at.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">julia&gt; d = Dict(:x =&gt; 3)Dict{Symbol,Int64} with 1 entry:
  :x =&gt; 3

julia&gt; @tag!(d) # running from a script or inline evaluation
Dict{Symbol,Any} with 3 entries:
  :gitcommit =&gt; &quot;618b72bc0936404ab6a4dd8d15385868b8299d68&quot;
  :script =&gt; &quot;test\stools_tests.jl#10&quot;
  :x      =&gt; 3</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L325-L343">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.gitdescribe" href="#DrWatson.gitdescribe"><code>DrWatson.gitdescribe</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">gitdescribe(gitpath = projectdir(); dirty_suffix = &quot;-dirty&quot;, warn = true) -&gt; gitstr</code></pre><p>Return a string <code>gitstr</code> with the output of <code>git describe</code> if an annotated git tag exists, otherwise the current active commit id of the Git repository present in <code>gitpath</code>, which by default is the currently active project.</p><p>If the repository is dirty when this function is called the string will end with the value of the keyword <code>dirty_suffix</code>. When this happens, the keyword <code>warn = DrWatson.readenv(&quot;DRWATSON_WARN_DIRTY&quot;, true)</code> will trigger a warning to be printed if it is <code>true</code> (the default).</p><p>Return <code>nothing</code> if <code>gitpath</code> is not a Git repository, i.e. a directory within a git repository.</p><p>The format of the <code>git describe</code> output in general is</p><pre><code class="nohighlight hljs">`&quot;TAGNAME-[NUMBER_OF_COMMITS_AHEAD-]gLATEST_COMMIT_HASH[-dirty]&quot;`</code></pre><p>If the latest tag is <code>v1.2.3</code> and there are 5 additional commits while the latest commit hash is 334a0f225d9fba86161ab4c8892d4f023688159c, the output will be <code>v1.2.3-5-g334a0f</code>. Notice that git will shorten the hash if there are no ambiguous commits.</p><p>More information about the <code>git describe</code> output can be found on (https://git-scm.com/docs/git-describe)</p><p>See also <a href="#DrWatson.tag!"><code>tag!</code></a>.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">julia&gt; gitdescribe() # a tag exists
&quot;v1.2.3-g7364ab&quot;

julia&gt; gitdescribe() # a tag doesn&#39;t exist
&quot;96df587e45b29e7a46348a3d780db1f85f41de04&quot;

julia&gt; gitdescribe(path_to_a_dirty_repo)
&quot;3bf684c6a115e3dce484b7f200b66d3ced8b0832-dirty&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L8-L48">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.gitpatch" href="#DrWatson.gitpatch"><code>DrWatson.gitpatch</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">gitpatch(gitpath = projectdir())</code></pre><p>Generates a patch describing the changes of a dirty repository compared to its last commit; i.e. what <code>git diff HEAD</code> produces. The <code>gitpath</code> needs to point to a directory within a git repository, otherwise <code>nothing</code> is returned.</p><p>Be aware that <code>gitpatch</code> needs a working installation of Git, that can be found in the current PATH.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L125-L135">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.isdirty" href="#DrWatson.isdirty"><code>DrWatson.isdirty</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">isdirty(gitpath = projectdir()) -&gt; Bool</code></pre><p>Return <code>true</code> if <code>gitpath</code> is the path to a dirty Git repository, <code>false</code> otherwise.</p><p>Note that unlike <a href="#DrWatson.tag!"><code>tag!</code></a>, <code>isdirty</code> <strong>can</strong> error (for example, if the path passed to it doesn&#39;t exist, or isn&#39;t a Git repository). The purpose of <code>isdirty</code> is to be used as a check before running simulations, for users that do not wish to tag data while having a dirty git repo.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L88-L97">source</a></section></article><p>Please notice that <code>tag!</code> will operate in place only when possible. If not possible then a new dictionary is returned. Also (importantly) these functions will <strong>never error</strong> as they are most commonly used when saving simulations and this could risk data not being saved!</p><h2 id="Produce-or-Load"><a class="docs-heading-anchor" href="#Produce-or-Load">Produce or Load</a><a id="Produce-or-Load-1"></a><a class="docs-heading-anchor-permalink" href="#Produce-or-Load" title="Permalink"></a></h2><p><code>produce_or_load</code> is a function that very conveniently integrates with <a href="../name/#DrWatson.savename"><code>savename</code></a> to either load a file if it exists, or if it doesn&#39;t to produce it, save it and then return it!</p><p>This saves you the effort of checking if a file exists and then loading, or then running some code and saving, or writing a bunch of <code>if</code> clauses in your code. In addition, it attempts to minimize computing energy spent on getting a result.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.produce_or_load" href="#DrWatson.produce_or_load"><code>DrWatson.produce_or_load</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">produce_or_load(f::Function, config, path = &quot;&quot;; kwargs...) -&gt; data, file</code></pre><p>The goal of <code>produce_or_load</code> is to avoid running some data-producing code that has already been run with a given configuration container <code>config</code>. If the output of some function <code>f(config)</code> exists on disk, <code>produce_or_load</code> will load it and return it, and if not, it will produce it, save it, and then return it.</p><p>Here is how it works:</p><ol><li>The output data are saved in a file named <code>name = filename(config)</code>. I.e., the output file&#39;s name is created from the configuration container <code>config</code>. By default, this is <code>name =</code><a href="../name/#DrWatson.savename"><code>savename</code></a><code>(config)</code>, but can be configured differently, using e.g. <code>hash</code>, see keyword <code>filename</code> below. See also <a href="../real_world/#produce_or_load-with-hash-codes"><code>produce_or_load</code> with hash codes</a> for an example where <code>config</code> would be hard to put into <code>name</code> with <code>savename</code>, and <code>hash</code> is used instead.</li><li>Now, let <code>file = joinpath(path, name)</code>.</li><li>If <code>file</code> exists, load it and return the contained <code>data</code>, along with the global path that it is saved at (<code>file</code>).</li><li>If the file does not exist then call <code>data = f(config)</code>, with <code>f</code> your function that produces your data from the configuration container.</li><li>Then save the <code>data</code> as <code>file</code> and then return <code>data, file</code>.</li></ol><p>The function <code>f</code> should return a string-keyed dictionary if the data are saved in the default format of JLD2.jl., the macro <a href="../name/#DrWatson.@strdict"><code>@strdict</code></a> can help with that.</p><p>You can use a <a href="https://docs.julialang.org/en/v1/manual/functions/#Do-Block-Syntax-for-Function-Arguments">do-block</a> instead of defining a function to pass in. For example,</p><pre><code class="language-julia hljs">produce_or_load(config, path) do config
    # code using `config` runs here
    # and then returns a dictionary to be saved
end</code></pre><p><strong>Keywords</strong></p><p><strong>Name deciding</strong></p><ul><li><code>filename::Union{Function, String} = savename</code> : Configures the <code>name</code> of the file to produce or load given the configuration container. It may be a one-argument function of <code>config</code>, <a href="../name/#DrWatson.savename"><code>savename</code></a> by default, so that <code>name = filename(config)</code>. Useful alternative to <code>savename</code> is <code>hash</code>. The keyword <code>filename</code> could also be a <code>String</code> directly, possibly extracted from <code>config</code> before calling <code>produce_or_load</code>, in which case <code>name = filename</code>.</li><li><code>suffix = &quot;jld2&quot;, prefix = default_prefix(config)</code> : If not empty, added to <code>name</code> as <code>name = prefix*&#39;_&#39;*name*&#39;.&#39;*suffix</code> (i.e., like in <a href="../name/#DrWatson.savename"><code>savename</code></a>).</li></ul><p><strong>Saving</strong></p><ul><li><code>tag::Bool = DrWatson.readenv(&quot;DRWATSON_TAG&quot;, istaggable(suffix))</code> : Save the file using <a href="#DrWatson.tagsave"><code>tagsave</code></a> if <code>true</code> (which is the default).</li><li><code>gitpath, storepatch</code> : Given to <a href="#DrWatson.tagsave"><code>tagsave</code></a> if <code>tag</code> is <code>true</code>.</li><li><code>force = false</code> : If <code>true</code> then don&#39;t check if <code>file</code> exists and produce it and save it anyway.</li><li><code>loadfile = true</code> : If <code>false</code>, this function does not actually load the file, but only checks if it exists. The return value in this case is always <code>nothing, file</code>, regardless of whether the file exists or not. If it doesn&#39;t exist it is still produced and saved.</li><li><code>verbose = true</code> : print info about the process, if the file doesn&#39;t exist.</li><li><code>wsave_kwargs = (;)</code> : Keywords to pass to <code>wsave</code> (e.g. to enable compression). Defaults to an empty named tuple.</li><li><code>wload_kwargs = (;)</code> : Keywords to pass to <code>wload</code> (e.g. to pass a typemap). Defaults to an empty named tuple.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_files.jl#L3-L64">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.@produce_or_load" href="#DrWatson.@produce_or_load"><code>DrWatson.@produce_or_load</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@produce_or_load(f, config, path; kwargs...)</code></pre><p>Same as <a href="#DrWatson.produce_or_load"><code>produce_or_load</code></a> but one more field <code>:script</code> is added that records the local path of the script and line number that called <code>@produce_or_load</code>, see <a href="#DrWatson.@tag!"><code>@tag!</code></a>.</p><p>Notice that <code>path</code> here is mandatory in contrast to <a href="#DrWatson.produce_or_load"><code>produce_or_load</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_files.jl#L150-L157">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.istaggable" href="#DrWatson.istaggable"><code>DrWatson.istaggable</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">istaggable(file::AbstractStrig) → bool</code></pre><p>Return <code>true</code> if the file save format (file ending) is &quot;taggable&quot;, i.e. allows adding additional data fields as strings. Currently endings that can do this are:</p><pre><code class="nohighlight hljs">(&quot;bson&quot;, &quot;jld&quot;, &quot;jld2&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L363-L370">source</a></section><section><div><pre><code class="language-julia hljs">istaggable(x) = x isa AbstractDict</code></pre><p>For non-string input the function just checks if input is dictionary.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L373-L376">source</a></section></article><p>See <a href="../real_world/#Stopping-&quot;Did-I-run-this?&quot;">Stopping &quot;Did I run this?&quot;</a> for an example usage of <code>produce_or_load</code>. While <code>produce_or_load</code> will try to by default tag your data if possible, you can also use it with other formats. An example is when your simulation function <code>f</code> returns a <code>DataFrame</code> and the file suffix is <code>&quot;csv&quot;</code>. In this case tagging will not happen, but <code>produce_or_load</code> will work as expected.</p><h2 id="Converting-a-struct-to-a-dictionary"><a class="docs-heading-anchor" href="#Converting-a-struct-to-a-dictionary">Converting a struct to a dictionary</a><a id="Converting-a-struct-to-a-dictionary-1"></a><a class="docs-heading-anchor-permalink" href="#Converting-a-struct-to-a-dictionary" title="Permalink"></a></h2><p><a href="../name/#DrWatson.savename"><code>savename</code></a> gives great support for getting a name out of any Julia composite type. To save something though, one needs a dictionary. So the following function can be conveniently used to directly save a struct using any saving function:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.struct2dict" href="#DrWatson.struct2dict"><code>DrWatson.struct2dict</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct2dict([type = Dict,] s) -&gt; d</code></pre><p>Convert a Julia composite type <code>s</code> to a dictionary <code>d</code> with key type <code>Symbol</code> that maps each field of <code>s</code> to its value. Simply passing <code>s</code> will return a regular dictionary. This can be useful in e.g. saving:</p><pre><code class="nohighlight hljs">tagsave(savename(s), struct2dict(s))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L380-L388">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DrWatson.struct2ntuple" href="#DrWatson.struct2ntuple"><code>DrWatson.struct2ntuple</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct2ntuple(s) -&gt; n</code></pre><p>Convert a Julia composite type <code>s</code> to a NamedTuple <code>n</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDynamics/DrWatson.jl/blob/efefab2401e74ac093f7acce3b3fb2a5688a572e/src/saving_tools.jl#L394-L397">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../name/">« Naming Simulations</a><a class="docs-footer-nextpage" href="../run&amp;list/">Running &amp; Listing Simulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 23 July 2025 20:00">Wednesday 23 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
